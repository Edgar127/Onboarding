<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Display a map on a webpage</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <!-- Js file for adding a marker -->
  <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 75%;
      right: 0
    }

    /* Reduce the map width to 75% */
    .Sidebar {
      width: 25%;
      /* Set the sidebar width to 25% of the viewport */
      display: block;
      padding: 8px 16px;
      text-align: left;
      border: none;
      white-space: normal;
      float: left;
      outline: 0;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div class="Sidebar">
    <a class="Top">Left </a>
    <a>Middle</a>
    <a>Right</a>
    <!-- Search for  -->
    <div class="Search">
      <br><br>
      <input id="search" type="text" placeholder="Search for ...">
      <button id="Btn" type="submit">Go</button>
      <p id="w"></p>
    </div>
    <!-- Drop list -->
    <div class="Drop List">
      <br>
      <select>
        <option>Select item from tis list</option>
      </select>
    </div>
  </div>

  <!-- Rendering the map -->
  <div id="map"></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZWRnYXIxMjciLCJhIjoiY2xrMzFodmFoMDM4eDNxcXdldGI3ZWJlMyJ9.rSpor_1z9qaL1Ng6yCuDvg';
    const map = new mapboxgl.Map({
      container: 'map', 
      
      style: 'mapbox://styles/mapbox/streets-v12', 
      center: [-74.5, 40], 
      zoom: 9 
    });
  </script>

  <script>

    let markers = {}; 
    let markerIdCounter = 0; 

    // Adding a click event listener
    map.on('style.load', function () {
      map.on("click", function (event) {
      // Get a new unique ID for the marker
        const markerId = markerIdCounter++; 
        const marker = new mapboxgl.Marker({
          color: "blue",
        }).setLngLat(event.lngLat).addTo(map);
        //Adds a pop up with coordinates
        var coordinates = event.lngLat;
        new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML('you clicked here: <br/>' + coordinates)
          .addTo(map);
        // Store the marker in the markers object with its unique ID
        markers[markerId] = marker;
      });
    });

    let longPressTimer;
    // Delete marker
    map.on("mousedown", function () {
      longPressTimer = setTimeout(() => {
        for (const markerId in markers) {
          markers[markerId].getElement().addEventListener("mousedown", function () {
            deleteMarkerById(markerId);
          });
        }
      }, 100);
    });

    // Clear the timer when mouseup event occurs
    map.on("mouseup", function () {
      clearTimeout(longPressTimer);
    });

    // Function to delete a specific marker by its ID
    function deleteMarkerById(id) {
      if (markers[id]) {
        markers[id].remove(); 
        delete markers[id]; // This line removes the marker object from the markers object
      }
    }

    element.addEventListener("click", function () {
      //Get the text the user types in
      //Stored inside userInputText!
      var userInputText = document.getElementById("search").value;

      makeMapGoSomewhere(userInputText);
      console.log("CLicked!", userInputText);

    })

    function makeMapGoSomewhere(address) {
      const mapboxClient = mapboxSdk({accessToken: mapboxgl.accessToken});
      mapboxClient.geocoding
        .forwardGeocode({
          query: address,
          autocomplete: false,
          limit: 1
        })
        .send()
        .then((response) => {
          if (
            !response ||
            !response.body ||
            !response.body.features ||
            !response.body.features.length
          ) {
            console.error('Invalid response:');
            console.error(response);
            return;
          }
          const feature = response.body.features[0];
          console.log(feature.center);


          // Create a marker and add it to the map.
          new mapboxgl.Marker().setLngLat(feature.center).addTo(map);


          //Fly to function
          map.flyTo({
            center: feature.center,
            essential: true
          });

        });

    }

  </script>
</body>

</html>